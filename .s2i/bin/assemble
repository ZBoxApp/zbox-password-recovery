#!/bin/bash

[ -d "/usr/src/app" ] && exit 0

set -e

echo "---> Installing application source"
cp -Rf /tmp/src/. ./

echo "restore build artifacts"
if [ "$(ls /tmp/s2i/artifacts/ 2>/dev/null)" ]; then
    mv /tmp/s2i/artifacts/* ./src
fi

echo "---> Building your Node application from source"
npm install -d

npm run build

# Fix source directory permissions
fix-permissions ./
